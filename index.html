<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Standupovka Alias</title>
    <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="container">
        <div class="grid" id="game-container">
            <section>
                <hgroup>
                    <h2 id="main-title">Standupovka Alias</h2>
                    <h3 id="sub-title">Începeți jocul și ghiciți cuvintele!</h3>
                </hgroup>
                <form id="settings-form">
                    <label for="team1">Numele echipei 1:</label>
                    <input type="text" id="team1" name="team1" required>
                    <label for="team2">Numele echipei 2:</label>
                    <input type="text" id="team2" name="team2" required>
                    <label for="team3">Numele echipei 3:</label>
                    <input type="text" id="team3" name="team3" required>
                    <label for="word-file">Încărcați propriile cuvinte:</label>
                    <input type="file" id="word-file" name="word-file" accept=".txt" required>
                </form>
                <button id="create-room" class="ios-button">Creează Cameră</button>
                <button id="join-room" class="ios-button">Alăturați-vă Camerei</button>
                <input type="text" id="room-id" placeholder="ID Cameră" style="display:none;">
                <button id="start-game" class="ios-button" style="display:none;">Începe jocul</button>
                <p id="word-display" style="display: none;">Aici va fi afișat cuvântul.</p>
                <div class="timer" id="timer" style="display: none;">00:00</div>
                <div id="team-scores"></div>
                <div class="buttons">
                    <button id="skip-word" class="ios-button" style="display:none;">Omite cuvântul</button>
                    <button id="next-word" class="ios-button" style="display:none;">Următorul cuvânt (1 punct)</button>
                </div>
                <button id="next-round" class="ios-button" style="display: none;">Următorul Rând</button>
                <button id="new-game" class="ios-button" style="display: none;">Începe jocul din nou</button>
            </section>
        </div>
    </main>
    <script>
        let timer;
        let words = [];
        let usedWords = [];
        let currentWord = '';
        let team1Score = 0;
        let team2Score = 0;
        let team3Score = 0;
        let currentTeam = 1;
        let ws;
        let roomId;

        document.getElementById('create-room').addEventListener('click', () => {
            ws = new WebSocket('ws://localhost:3000');
            ws.onopen = () => {
                ws.send(JSON.stringify({ type: 'create-room' }));
            };
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'room-created') {
                    roomId = data.roomId;
                    document.getElementById('room-id').value = roomId;
                    document.getElementById('room-id').style.display = 'block';
                    document.getElementById('create-room').style.display = 'none';
                    document.getElementById('join-room').style.display = 'none';
                    document.getElementById('start-game').style.display = 'block';
                }
            };
        });

        document.getElementById('join-room').addEventListener('click', () => {
            roomId = document.getElementById('room-id').value;
            ws = new WebSocket('ws://localhost:3000');
            ws.onopen = () => {
                ws.send(JSON.stringify({ type: 'join-room', roomId }));
            };
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'joined-room') {
                    document.getElementById('create-room').style.display = 'none';
                    document.getElementById('join-room').style.display = 'none';
                    document.getElementById('start-game').style.display = 'block';
                }
            };
        });

        document.getElementById('start-game').addEventListener('click', startGame);
        document.getElementById('skip-word').addEventListener('click', skipWord);
        document.getElementById('next-word').addEventListener('click', nextWord);

        function startGame() {
            const team1 = document.getElementById('team1').value;
            const team2 = document.getElementById('team2').value;
            const team3 = document.getElementById('team3').value;

            if (!team1 || !team2 || !team3) {
                alert('Introduceți numele echipelor!');
                return;
            }

            document.getElementById('settings-form').style.display = 'none';
            document.getElementById('start-game').style.display = 'none';
            document.getElementById('word-display').style.display = 'block';
            document.getElementById('timer').style.display = 'block';
            document.getElementById('skip-word').style.display = 'block';
            document.getElementById('next-word').style.display = 'block';

            const fileInput = document.getElementById('word-file');
            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                words = e.target.result.split('\n').map(word => word.trim()).filter(word => word);
                nextWord();
                startTimer();
            };

            reader.readAsText(file);
        }

        function startTimer() {
            let timeLeft = 60;
            timer = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endRound();
                } else {
                    document.getElementById('timer').innerText = `00:${timeLeft < 10 ? '0' + timeLeft : timeLeft}`;
                    timeLeft--;
                }
            }, 1000);
        }

        function nextWord() {
            if (words.length === 0) {
                alert('Nu mai sunt cuvinte disponibile.');
                return;
            }

            currentWord = words[Math.floor(Math.random() * words.length)];
            words = words.filter(word => word !== currentWord);
            usedWords.push(currentWord);
            document.getElementById('word-display').innerText = currentWord;
            ws.send(JSON.stringify({ type: 'new-word', roomId, word: currentWord }));
        }

        function skipWord() {
            nextWord();
        }

        function endRound() {
            document.getElementById('skip-word').style.display = 'none';
            document.getElementById('next-word').style.display = 'none';
            document.getElementById('next-round').style.display = 'block';
            clearInterval(timer);
            if (currentTeam === 1) {
                document.getElementById('team-scores').innerText = `Scorul echipei 1: ${team1Score}`;
            } else if (currentTeam === 2) {
                document.getElementById('team-scores').innerText = `Scorul echipei 2: ${team2Score}`;
            } else {
                document.getElementById('team-scores').innerText = `Scorul echipei 3: ${team3Score}`;
            }

            ws.send(JSON.stringify({ type: 'update-score', roomId, scores: { team1Score, team2Score, team3Score } }));
            document.getElementById('next-round').addEventListener('click', startNextRound);
        }

        function startNextRound() {
            document.getElementById('next-round').style.display = 'none';
            if (currentTeam === 1) {
                currentTeam = 2;
            } else if (currentTeam === 2) {
                currentTeam = 3;
            } else {
                currentTeam = 1;
                document.getElementById('next-round').style.display = 'none';
                document.getElementById('new-game').style.display = 'block';
                document.getElementById('team-scores').innerHTML = `
                    <h1>Scorul echipei 1: ${team1Score}</h1>
                    <h1>Scorul echipei 2: ${team2Score}</h1>
                    <h1>Scorul echipei 3: ${team3Score}</h1>
                `;
                return;
            }

            startGame();
        }
    </script>
</body>
</html>
